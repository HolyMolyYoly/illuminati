Array.prototype.inArrayCheck=function(d,c){var b=c.length;for(var a=0;a<b;a++){if(c[a]===d){return true}}return false};var _send=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(){if(this.responseURL.indexOf(collectorUrl)==-1){illuminatiAjax.setRequestHeaderOnAjaxEvent(this)}var a=typeof this.onreadystatechange=="function"?this.onreadystatechange:null;this.onreadystatechange=function(){if(a){a.apply(this,arguments)}if(this.readyState==4){if(this.responseURL.indexOf(collectorUrl)==-1){try{illuminatiJsAgent.tempBufferToBuffer();illuminatiJsAgent.sendToIlluminati(false)}catch(b){}}}};_send.apply(this,arguments)};var illuminatiJsAgent={passElementType:["form","input","select","textarea"],illuminatiInputElementType:["text","radio","checkbox"],init:function(){illuminatiJsAgent.setSessionStorage("illuminatiSProcId",illuminatiJsAgent.generateTransactionId("S"));var a=illuminatiJsAgent.getSessionStorage("illuminatiGProcId");if(typeof a==="undefined"||a===null){illuminatiJsAgent.setSessionStorage("illuminatiGProcId",String(illuminatiJsAgent.generateTransactionId("G")))}if(typeof isAutoCollect!=="undefined"&&isAutoCollect===true){autoSendToIlluminati=window.setInterval(function(){illuminatiJsAgent.sendToIlluminati(true)},collectIntervalTimeMs)}},setUniqueUserId:function(a){if(typeof a!=="undefined"&&a!==null){illuminatiJsAgent.setSessionStorage("illuminatiUniqueUserId",String(a))}},setSessionStorage:function(a,b){try{window.sessionStorage.setItem(a,b)}catch(c){console.debug("This browser is not support session storage.")}},getSessionStorage:function(a){try{return window.sessionStorage.getItem(a)}catch(b){console.debug("This browser is not support session storage.");return null}},removeSessionStorage:function(a){try{window.sessionStorage.removeItem(a)}catch(b){console.debug("This browser is not support session storage.")}},checkIsIe:function(){if(navigator.appName=="Microsoft Internet Explorer"||!!(navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/rv:11/))){return true}return false},generateUDID:function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)},generateSumUDID:function(){var b=[];for(var a=0;a<8;a++){b[b.length]=illuminatiJsAgent.generateUDID()}return b},generateTransactionId:function(a){return illuminatiJsAgent.generateSumUDID().join("")+"-illuminati"+a+"ProcId"},generateHiddenInputElement:function(c,a,d,g){try{var b=document.createElement("input");b.type="hidden";b.name=a;b.value=String(d);if(typeof g!=="undefined"&&g!==null){b.id=g}c.appendChild(b)}catch(f){console.debug("create hidden input element exception : ",f)}},getElementUniqueId:function(a){return(typeof a.id!=="undefined"&&a.id!==null&&a.id.trim()!=="")?a.id:a.name},checkPassElement:function(a){if(Array.prototype.inArrayCheck(a.localName,illuminatiJsAgent.passElementType)===false){return true}if(typeof a.getAttribute("id")==="undefined"&&a.getAttribute("name")==="undefined"){return true}var b=false;if(typeof a.getAttribute("id")!=="undefined"&&a.getAttribute("id")!=null&&a.getAttribute("id").trim()===""){b=true}if(typeof a.getAttribute("name")!=="undefined"&&a.getAttribute("name")!=null&&a.getAttribute("name").trim()===""){b=true}if(b===true){return true}if(a.localName==="input"&&Array.prototype.inArrayCheck(a.type,illuminatiJsAgent.illuminatiInputElementType)===false){return true}return false},getScreenInfoAtEvent:function(b){var a={browserWidth:window.innerWidth||document.body.clientWidth,browserHeight:window.innerHeight||document.body.clientHeight,clientX:b.clientX,clientY:b.clientY,layerX:b.layerX,layerY:b.layerY,offsetX:b.offsetX,offsetY:b.offsetY,screenX:b.screenX,screenY:b.screenY,x:b.x,y:b.y};return a},getElementObj:function(a){if(typeof a.id!=="undefined"&&a.id!==null&&a.id.trim()!==""){return document.getElementById(a.id.trim())}else{if(typeof a.name!=="undefined"&&a.name!==null&&a.name.trim()!==""){return document.getElementsByName(a.name.trim())}}return null},getChangedAttributeValue:function(e,d,b,g,c,a){var f={};f.elementType=e;f.elementUniqueId=d;f.attributeName=b;f.oldData=String(g);f.newData=String(c);f.index=(typeof a!=="undefined"&&a!==null)?a:0;return f},getEventData:function(j){var a={};var b={};for(var d=0;d<j.target.attributes.length;d++){var h=j.target.attributes.item(d);switch(h.name){case"id":a.id=h.value;case"name":a.name=h.value;default:b[h.name]=h.value;break}}if(j.target.type.indexOf("textarea")>-1){var g=illuminatiJsAgent.getElementObj(a);b.value=g.value}a.attributes=b;a.obj=illuminatiJsAgent.getElementObj(a);if(j.target.type.indexOf("select")>-1){var f=JSON.parse(illuminatiJsAgent.getSessionStorage("illuminati"));var c=j.target.type+"-"+illuminatiJsAgent.getElementUniqueId(a);a.obj=f[c]}else{if(a.attributes.hasOwnProperty("type")===true){if(a.attributes["type"]==="checkbox"){a.checked=j.target.checked}else{if(a.attributes["type"]==="radio"){var f=JSON.parse(illuminatiJsAgent.getSessionStorage("illuminati"));var c=j.target.type+"-"+illuminatiJsAgent.getElementUniqueId(a);a.obj=f[c]}}}}a.elementUniqueId=illuminatiJsAgent.getElementUniqueId(a);a.target=j.target;return a},getNewEventData:function(oldObject){var newObject={};var targetObject=oldObject.target;newObject.id=targetObject.getAttribute("id");newObject.name=targetObject.getAttribute("name");var tmpTargetObject=illuminatiJsAgent.getElementObj(newObject);if(tmpTargetObject!==null){targetObject=tmpTargetObject}var objectAttributes={};var changedInfo={};objectAttributes.elementUniqueId=oldObject.elementUniqueId;objectAttributes.type=oldObject.target.type;objectAttributes.target=oldObject.target;changedInfo.changedValues=[];var ignoreRemoveKeys=["target","elementUniqueId"];if(typeof oldObject.target.type!=="undefined"){if(oldObject.target.type.indexOf("select")>-1){for(var q=0;q<oldObject.obj.option.length;q++){var tempSelectOption=oldObject.obj.option[q];if((tempSelectOption.hasOwnProperty("selected")===true&&targetObject[q].selected===false)||(tempSelectOption.hasOwnProperty("selected")===false&&targetObject[q].selected===true)){changedInfo.changedValues[changedInfo.changedValues.length]=illuminatiJsAgent.getChangedAttributeValue("select",oldObject.elementUniqueId,"selected",tempSelectOption.hasOwnProperty("selected"),targetObject[q].selected);Object.keys(tempSelectOption).map(function(objectKey,index){if(tempSelectOption.hasOwnProperty(objectKey)===true){try{objectAttributes[objectKey]=eval("tempSelectOption."+objectKey)}catch(e){}}})}}objectAttributes.obj=oldObject.obj;objectAttributes.id=oldObject.id;objectAttributes.name=oldObject.name}else{if(oldObject.target.type.indexOf("radio")>-1){objectAttributes.type="radio";for(var p=0;p<oldObject.obj.length;p++){var tempOldRadioObj=oldObject.obj[p];if((tempOldRadioObj.hasOwnProperty("checked")===true&&targetObject.checked===false)||(tempOldRadioObj.hasOwnProperty("checked")===false&&targetObject.checked===true)){var radioElementUniqueId=illuminatiJsAgent.getElementUniqueId(tempOldRadioObj);changedInfo.changedValues[changedInfo.changedValues.length]=illuminatiJsAgent.getChangedAttributeValue("radio",radioElementUniqueId,"checked",tempOldRadioObj.hasOwnProperty("checked"),targetObject.checked,p);Object.keys(tempOldRadioObj).map(function(objectKey,index){if(tempOldRadioObj.hasOwnProperty(objectKey)===true){try{objectAttributes[objectKey]=eval("tempOldRadioObj."+objectKey)}catch(e){}}})}}}else{if(oldObject.target.type.indexOf("checkbox")>-1){if((oldObject.checked===true&&targetObject.checked===false)||(oldObject.checked===false&&targetObject.checked===true)){changedInfo.changedValues[0]=illuminatiJsAgent.getChangedAttributeValue("checkbox",oldObject.elementUniqueId,"checked",oldObject.checked,targetObject.checked);for(var i=0;i<targetObject.attributes.length;i++){try{var item=targetObject.attributes.item(i);objectAttributes[item.name]=eval("targetObject."+item.name)}catch(e){}}}}else{for(var i=0;i<targetObject.attributes.length;i++){try{var item=targetObject.attributes.item(i);objectAttributes[item.name]=eval("targetObject."+item.name)}catch(e){}}if(oldObject.obj.type.indexOf("textarea")>-1){objectAttributes.value=targetObject.value}Object.keys(objectAttributes).map(function(objectKey,index){if(oldObject.attributes.hasOwnProperty(objectKey)===true&&(oldObject.attributes[objectKey]!==objectAttributes[objectKey])){changedInfo.changedValues[changedInfo.changedValues.length]=illuminatiJsAgent.getChangedAttributeValue(oldObject.target.localName,oldObject.elementUniqueId,objectKey,oldObject.attributes[objectKey],objectAttributes[objectKey])}else{if((oldObject.attributes.hasOwnProperty(objectKey)===false)&&(Array.prototype.inArrayCheck(objectKey,ignoreRemoveKeys)===false)){changedInfo.removedKey=objectKey}}})}}}}if(changedInfo.changedValues.length>0){objectAttributes.changedInfo=changedInfo}return objectAttributes},tempBufferToBuffer:function(){var a=illuminatiJsAgent.getSessionStorage("illuminati-buffer-temp");if(a!=="undefined"&&a!==null){illuminatiJsAgent.setSessionStorage("illuminati-buffer",illuminatiJsAgent.getSessionStorage("illuminati-buffer-temp"));illuminatiJsAgent.removeSessionStorage("illuminati-buffer-temp");return true}return false},setElementToSessionStorage:function(d){if(d.hasOwnProperty("changedInfo")===true){var c=JSON.parse(illuminatiJsAgent.getSessionStorage("illuminati"));var b=d.target.type+"-"+d.elementUniqueId;var e="illuminati-buffer";if(illuminatiSendStatus==="sending"){e+="-temp"}var a=JSON.parse(illuminatiJsAgent.getSessionStorage(e));if(typeof a!=="undefined"&&a!=null){c=a}if(Array.isArray(c[b])===false){c[b]["changedInfo"]=d.changedInfo}else{var f=c[b];c[b]={obj:f,type:d.type,changedInfo:d.changedInfo}}illuminatiJsAgent.setSessionStorage(e,JSON.stringify(c))}},domElementInit:function(){if(document.readyState==="complete"){window.clearInterval(interval);var u=document.body.getElementsByTagName("*");var c={};var e={};for(var q=0;q<u.length;q++){var r=u[q];if(illuminatiJsAgent.checkPassElement(r)==true){continue}var v={originElement:r,type:r.type,id:r.getAttribute("id"),name:r.getAttribute("name")};if(r.localName==="form"){v.type="form"}var w=illuminatiJsAgent.getElementUniqueId(v);if(r.localName==="input"&&r.getAttribute("type")==="radio"){if(c.hasOwnProperty(v.type+"-"+w)===false){c[v.type+"-"+w]=[]}var d={};for(var p=0;p<r.attributes.length;p++){var s=r.attributes.item(p);d[s.name]=s.value}d.originElement=r;c[v.type+"-"+w][c[v.type+"-"+w].length]=d;continue}for(var p=0;p<r.attributes.length;p++){var s=r.attributes.item(p);if(r.localName==="select"){v.option=[];for(var o=0;o<r.childElementCount;o++){var g={};for(var l=0;l<r[o].attributes.length;l++){var f=r[o].attributes.item(l);g[f.name]=f.value}v.option[v.option.length]=g}}else{v[s.name]=s.value}}if(r.localName==="textarea"){v.value=r.value}var x=v.type+"-"+w;e[x]=v}for(var x in c){e[x]=c[x]}for(var x in e){var a=e[x];if(Array.isArray(a)!==true){switch(a.type){case"text":a.originElement.addEventListener("keyup",function(k){var m=illuminatiJsAgent.getScreenInfoAtEvent(k);var i=illuminatiJsAgent.getEventData(k);var j=illuminatiJsAgent.getNewEventData(i);j.screenInfo=m;illuminatiJsAgent.setElementToSessionStorage(j)});break;case"textarea":var t;a.originElement.addEventListener("focusin",function(i){t=illuminatiJsAgent.getScreenInfoAtEvent(i);lastCheckObject=illuminatiJsAgent.getEventData(i)});a.originElement.addEventListener("keyup",function(j){var i=illuminatiJsAgent.getNewEventData(lastCheckObject);i.screenInfo=t;illuminatiJsAgent.setElementToSessionStorage(i)});break;case"select-one":a.originElement.addEventListener("change",function(k){var m=illuminatiJsAgent.getScreenInfoAtEvent(k);var i=illuminatiJsAgent.getEventData(k);var j=illuminatiJsAgent.getNewEventData(i);j.screenInfo=m;illuminatiJsAgent.setElementToSessionStorage(j)});break;case"form":a.originElement.addEventListener("submit",function(k){if(k.preventDefault){k.preventDefault()}var j=illuminatiJsAgent.getSessionStorage("illuminatiSProcId");if(typeof j!=="undefined"&&j!==null){illuminatiJsAgent.generateHiddenInputElement(this,"illuminatiSProcId",j)}var m=illuminatiJsAgent.getSessionStorage("illuminatiGProcId");if(typeof m!=="undefined"&&m!==null){illuminatiJsAgent.generateHiddenInputElement(this,"illuminatiGProcId",m)}var i=illuminatiJsAgent.getSessionStorage("illuminatiUniqueUserId");if(typeof i!=="undefined"&&i!==null){illuminatiJsAgent.generateHiddenInputElement(this,"illuminatiUniqueUserId",i)}try{illuminatiJsAgent.tempBufferToBuffer();illuminatiJsAgent.sendToIlluminati(false);this.submit()}catch(k){}});break;default:var t;a.originElement.addEventListener("mouseup",function(i){t=illuminatiJsAgent.getScreenInfoAtEvent(i);lastCheckObject=illuminatiJsAgent.getEventData(i)});a.originElement.addEventListener("click",function(j){var i=illuminatiJsAgent.getNewEventData(lastCheckObject);i.screenInfo=t;delete (lastClickObject);illuminatiJsAgent.setElementToSessionStorage(i)});break}}else{for(var h=0;h<a.length;h++){var b=a[h];b.originElement.addEventListener("click",function(k){var m=illuminatiJsAgent.getScreenInfoAtEvent(k);var i=illuminatiJsAgent.getEventData(k);var j=illuminatiJsAgent.getNewEventData(i);j.screenInfo=m;illuminatiJsAgent.setElementToSessionStorage(j)})}}}for(var x in e){delete e[x]["originElement"]}illuminatiJsAgent.setSessionStorage("illuminati",JSON.stringify(e));if(isFirst===true){isFirst=false;window.setTimeout(function(){illuminatiJsAgent.domElementInit()},3000)}}},sendToIlluminati:function(b){if(illuminatiSendStatus==="done"){var a=JSON.parse(illuminatiJsAgent.getSessionStorage("illuminati-buffer"));if(typeof a==="undefined"||a===null){return}illuminatiSendStatus="sending";var d={illuminatiGProcId:illuminatiJsAgent.getSessionStorage("illuminatiGProcId"),illuminatiSProcId:illuminatiJsAgent.getSessionStorage("illuminatiSProcId"),illuminatiUniqueUserId:illuminatiJsAgent.getSessionStorage("illuminatiUniqueUserId")};var f=["alreadySent"];Object.keys(a).map(function(h,g){if(Array.prototype.inArrayCheck(h,f)===false){if(a[h].hasOwnProperty("changedInfo")===true){var i=a[h];if(d.hasOwnProperty("changedValues")===true){for(var e=0;e<i.changedInfo["changedValues"].length;e++){d.changedValues[d.changedValues.length]=i.changedInfo["changedValues"][e]}}else{d.changedValues=i.changedInfo["changedValues"]}}}});if(d.hasOwnProperty("changedValues")===true){try{illuminatiAjax.sendByPost(collectorUrl,b,d)}catch(c){}illuminatiSendStatus="done";if(illuminatiJsAgent.tempBufferToBuffer()===false){illuminatiJsAgent.removeSessionStorage("illuminati-buffer")}}}}};var illuminatiXhr;var illuminatiAjax={xmlHttpObjType:null,timeoutMs:5000,init:function(){if(typeof XMLHttpRequest!=="undefined"){illuminatiXhr=new XMLHttpRequest()}else{var b=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];for(var c=0,a=b.length;c<a;c++){try{illuminatiXhr=new ActiveXObject(b[c]);break}catch(d){}}}},setRequestHeaderOnAjaxEvent:function(c){var b=illuminatiJsAgent.getSessionStorage("illuminatiGProcId");if(typeof b!=="undefined"&&b!==null){c.setRequestHeader("illuminatiGProcId",b)}var d=illuminatiJsAgent.getSessionStorage("illuminatiSProcId");if(typeof d!=="undefined"&&d!==null){c.setRequestHeader("illuminatiSProcId",d)}var a=illuminatiJsAgent.getSessionStorage("illuminatiUniqueUserId");if(typeof a!=="undefined"&&a!==null){c.setRequestHeader("illuminatiUniqueUserId",a)}},sendByPost:function(a,c,b){illuminatiXhr.open("POST",a,c);illuminatiXhr.setRequestHeader("Content-Type","application/json; charset=UTF-8");illuminatiAjax.setRequestHeaderOnAjaxEvent(illuminatiXhr);illuminatiXhr.send(JSON.stringify(b));setTimeout(function(){illuminatiXhr.abort()},this.timeoutMs);if(c===false&&illuminatiXhr.readyState===4&&illuminatiXhr.status===200){return true}}};var illuminatiSendStatus="done";var lastCheckObject;var isFirst=true;var collectIntervalTimeMs=15000;var autoSendToIlluminati;var collectorUrl="/illuminati/js/collector";var isAutoCollect=true;var interval=window.setInterval(function(){illuminatiJsAgent.domElementInit()},100);